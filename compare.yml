---

   - name: collect data about the file
     template:
       src: "{{first_dir}}/{{inventory_hostname}}/{{ item| basename }}"
       dest: "{{first_dir}}/{{inventory_hostname}}/{{ item| basename }}"
     diff: yes
     check_mode: yes
     register: first_file
     delegate_to: localhost

   - template:
      src: "{{sec_dir}}/{{inventory_hostname}}/{{ item| basename }}"
      dest: "{{sec_dir}}/{{inventory_hostname}}/{{ item| basename }}"
     diff: yes
     check_mode: yes
     register: sec_file
     delegate_to: localhost
  
   - set_fact:
       group_var: [" {{ item|basename }} {{sec_file['owner']}} : {{sec_file['group']}}  to {{first_file['owner']}} : {{first_file['group']}}"]
     when:   first_file['group'] != sec_file['group'] or   first_file['owner'] != sec_file['owner']

   - set_fact:
       changes_list: "{{ changes_list + group_var}}"
     when:  first_file['group'] != sec_file['group'] or   first_file['owner'] != sec_file['owner']

   - set_fact:
       mode_var: [" {{ item|basename }}'s mode  -->  {{sec_file['mode']}} to {{first_file['mode']}}"]
     when: not  first_file['mode'] == sec_file['mode']


   - set_fact:
       changes_list: "{{ changes_list + mode_var}}"
     when: not  first_file['mode'] == sec_file['mode']

   - set_fact:
       context_var: [" {{ item|basename }}'s secontext  -->   {{first_file['secontext']}}"]
     when: not  first_file['secontext'] == sec_file['secontext']

   - set_fact:
       changes_list: "{{ changes_list + context_var}}"
     when: not  first_file['secontext'] == sec_file['secontext']


   - name: get the difference between the files
     copy:
       src: "{{sec_dir}}/{{inventory_hostname}}/{{ item| basename }}"
       dest: "{{fisrt_dir}}/{{inventory_hostname}}/{{ item| basename }}"
     check_mode: yes
     diff: yes
     register: d
     when: not  first_file['checksum'] == sec_file['checksum']

   - name:
     set_fact:
      con_changes: [ { file: "{{ item|basename }} " , changes: "{{d.diff}}.split('\n')"} ]
     when: not  first_file['checksum'] == sec_file['checksum']

   - name: add the difference to the list
     set_fact:
      content_changes: "{{ con_changes + content_changes}}"
     when: not  first_file['checksum'] == sec_file['checksum']
